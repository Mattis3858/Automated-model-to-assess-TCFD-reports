from ollama import chat, Client

OLLAMA_API_KEY = "3127934443274ff18693ee2187960c39.ECH-n725qHsWBsLDe8_6Cm5b"

PROMPT = """
【角色設定】
你是一位嚴謹的氣候相關財務揭露 (TCFD) 專家。你的任務是負責審閱報告書內容，並判斷報告書內容是否有符合提供的 TCFD 揭露標準。

【背景資訊】
我們正在進行自動化評估企業的 TCFD 報告書，以確保其符合最新的揭露標準。
你將協助我們審閱報告書中的文本塊，並根據每個文本塊的內容，判斷其是否符合特定的 TCFD 揭露標準。

【核心任務】
1. 閱讀並理解提供的報告書文本塊。
2. 根據提供的 TCFD 揭露標準，判斷文本塊是否符合該標準。
3. 提供詳細的推理過程，說明你的判斷依據。
4. 以指定的 JSON 格式輸出結果。

【注意事項】
1. 請只根據【任務資訊提供】中的內容進行判斷，請勿進行任何過度推論。
2. 請勿在回覆中包含與任務無關的資訊。

【任務資訊提供】
- TCFD 揭露標準：
「公司是否描述氣候相關風險與機會對財務狀況（例如資產、負債）的影響？」

- 報告書文本塊：
「2021 氣候相關財務揭露建議 TCFD  報告書 17 TCFD 一般揭露項目 表5 氣候變遷對營運策略之影響 2. 組織在業務、策略和財務規劃上與氣候相關風險與機會的衝擊 彰銀盤點鑑別出之氣候相關風險與機會對公司各面向( 產品與服務、供應鏈和/ 或價值鏈、研發投資、 營運) 之影響( 表5)，詳細說明包括涵蓋氣候相關議題之公司政策與授信機制，並於氣候變遷對財務 規劃之影響（表6）詳述氣候相關風險與機會對彰銀財務規劃之具體影響。」

【思考步驟（每步一句）】
1. 萃取「TCFD 揭露標準」的關鍵要素。
2. 逐一比對「報告書文本塊」是否提供可直接支持該要素的明確證據。
3. 列出支持每個要素的文本證據，或說明缺少哪些要素。
4. 假如缺少了關鍵要素，或文本證據不充分，則判斷為不符合該標準，並在 reasoning 中說明缺少哪些關鍵要素，或哪些文本證據不充分。
5. 根據上述的思考過程，在 reasoning 撰寫詳細的推理過程。如果所有要素皆有充分證據 is_disclosed="Y"；否則 is_disclosed="N"。
6. 依下列刻度給 `confidence`（0–1，保留兩位小數）：
   - 全要素且證據明確：0.80–1.00
   - 部分要素或證據弱：0.50–0.79
   - 幾乎無證據：0.00–0.49

【輸出格式】
請以 JSON 格式輸出，每題一筆資料，包含以下必填欄位：
1.  reasoning: string。上述【思考步驟】完整思考過程。
2.  is_disclosed: string。明確且充分地揭露了該標準的定義，則回覆 'Y'；若未明確揭露或內容不符合定義，則回覆 'N'
3.  confidence: float。請提供一個 0 到 1 之間的數字，表示你對此判斷的信心程度，1 表示非常有信心，0 表示完全沒有信心

【輸出範例】
範例一:
{"result":[
    {
        "reasoning": "...",
        "is_disclosed": "Y",
        "confidence": 0.95
    }
]}
範例二:
{"result":[
    {
        "reasoning": "...",
        "is_disclosed": "N",
        "confidence": 0.43
    }
]}
"""

client = Client(
    host="https://ollama.com",
    headers={'Authorization': OLLAMA_API_KEY}
)

messages = [
  {
    'role': 'user',
    'content': PROMPT,
  },
]

response = client.chat('gpt-oss:20b', messages=messages, stream=False)

print(response)
